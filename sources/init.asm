; ** DankOS shell **

org 0x0100

bits 16							; 16-bit real mode

mov si, splash_text				; Print logo
push 0x02
int 0x80

mov si, intro					; Print intro
push 0x02
int 0x80

prompt_loop:

mov si, prompt					; Draw prompt
push 0x02
int 0x80
mov bx, 200						; Limit input to 200 characters
mov di, prompt_input			; Point to local buffer
push 0x10
int 0x80						; Input string
push 0x03
int 0x80						; New line
cmp byte [prompt_input], 0x00	; If no input, restart loop
je prompt_loop

; ***** Check for internal commands *****

mov si, prompt_input

mov di, exit_msg				; Exit command
push 0x08
int 0x80
jc exit_cmd

mov di, clear_msg				; Clear command
push 0x08
int 0x80
jc clear_cmd





push 0x13
int 0x80						; Load current drive in DL
mov si, prompt_input			; Prepare SI for start process function
xor eax, eax					; Reset EAX
push 0x14
int 0x80						; Try to start new process
cmp eax, 0xFFFFFFFF				; If fail, print error message
jne prompt_loop					; Otherwise restart the loop

mov si, not_found
push 0x02
int 0x80
jmp prompt_loop

data:

intro		db	0x0A
			db	0x0A, 'DankOS shell, welcome!'
			db	0x0A, 0x0A, 0x00

prompt		db	'>> ', 0x00

not_found	db	'Invalid command or file name.', 0x0A, 0x00

splash_text	db	0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x64,0x4D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x72,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x34,0x4D,0x4D,0x4D,0x4C,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x4D,0x4D,0x4D,0x2E,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x78,0x66,0x0A,0x20,0x20,0x20,0x20,0x20,0x2E,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x22,0x4D,0x36,0x4D,0x4D,0x4D,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x4D,0x4D,0x2D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x68,0x2E,0x2E,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2B,0x4D,0x4D,0x35,0x4D,0x4D,0x4D,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x4D,0x4D,0x4D,0x4D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x4D,0x4D,0x4D,0x2E,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x4D,0x4D,0x4D,0x4D,0x4D,0x4C,0x2E,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x4D,0x4D,0x4D,0x68,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x29,0x4D,0x4D,0x4D,0x68,0x2E,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x35,0x4D,0x4D,0x4D,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x33,0x4D,0x4D,0x4D,0x4D,0x78,0x2E,0x20,0x20,0x20,0x20,0x20,0x27,0x4D,0x4D,0x4D,0x33,0x4D,0x4D,0x66,0x20,0x20,0x20,0x20,0x20,0x20,0x78,0x6E,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x22,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x27,0x2A,0x4D,0x4D,0x4D,0x4D,0x4D,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x2E,0x20,0x20,0x20,0x20,0x20,0x6E,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x50,0x22,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2A,0x4D,0x4D,0x4D,0x4D,0x4D,0x78,0x20,0x20,0x20,0x20,0x22,0x4D,0x4D,0x4D,0x35,0x4D,0x5C,0x20,0x20,0x20,0x20,0x2E,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x3D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2A,0x4D,0x4D,0x4D,0x4D,0x4D,0x68,0x20,0x20,0x20,0x22,0x4D,0x4D,0x4D,0x4D,0x4D,0x22,0x20,0x20,0x20,0x4A,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x50,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x20,0x20,0x20,0x47,0x4D,0x4D,0x4D,0x4D,0x2E,0x20,0x20,0x64,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x20,0x20,0x22,0x4D,0x4D,0x4D,0x4D,0x20,0x20,0x2E,0x4D,0x4D,0x4D,0x4D,0x4D,0x28,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x6E,0x6E,0x4D,0x50,0x22,0x0A,0x20,0x20,0x20,0x2E,0x2E,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2A,0x4D,0x4D,0x4D,0x4D,0x78,0x20,0x20,0x4D,0x4D,0x4D,0x22,0x20,0x20,0x64,0x4D,0x4D,0x4D,0x4D,0x22,0x20,0x20,0x20,0x20,0x2E,0x6E,0x6E,0x4D,0x4D,0x4D,0x4D,0x4D,0x2A,0x0A,0x20,0x20,0x20,0x20,0x22,0x4D,0x4D,0x6E,0x2E,0x2E,0x2E,0x20,0x20,0x20,0x20,0x20,0x27,0x4D,0x4D,0x4D,0x4D,0x72,0x20,0x27,0x4D,0x4D,0x20,0x20,0x20,0x4D,0x4D,0x4D,0x22,0x20,0x20,0x20,0x2E,0x6E,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x2A,0x22,0x0A,0x20,0x20,0x20,0x20,0x20,0x22,0x34,0x4D,0x4D,0x4D,0x4D,0x6E,0x6E,0x2E,0x2E,0x20,0x20,0x20,0x2A,0x4D,0x4D,0x4D,0x20,0x20,0x4D,0x4D,0x20,0x20,0x4D,0x4D,0x50,0x22,0x20,0x20,0x2E,0x64,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x22,0x22,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5E,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x78,0x2E,0x20,0x20,0x2A,0x4D,0x4C,0x20,0x22,0x4D,0x20,0x2E,0x4D,0x2A,0x20,0x20,0x2E,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x2A,0x2A,0x22,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2A,0x50,0x4D,0x4D,0x4D,0x4D,0x4D,0x4D,0x68,0x6E,0x2E,0x20,0x2A,0x78,0x20,0x3E,0x20,0x4D,0x20,0x20,0x2E,0x4D,0x4D,0x4D,0x4D,0x2A,0x2A,0x22,0x22,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x22,0x22,0x2A,0x2A,0x4D,0x4D,0x4D,0x4D,0x68,0x78,0x2F,0x2E,0x68,0x2F,0x20,0x2E,0x3D,0x2A,0x22,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x2E,0x33,0x50,0x22,0x25,0x2E,0x2E,0x2E,0x2E,0x0A,0x09,0x09,0x20,0x20,0x20,0x20,0x6E,0x50,0x22,0x20,0x20,0x20,0x20,0x20,0x22,0x2A,0x4D,0x4D,0x6E,0x78,0x20,0x00


prompt_input	times 201 db 0x00




internal_commands:

exit_msg			db	'exit', 0x00
clear_msg			db	'clear', 0x00




%include 'includes/shell/exit.inc'
%include 'includes/shell/clear.inc'
